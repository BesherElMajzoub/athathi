<?php

namespace App\Services;

/**
 * Content Template Service
 *
 * Generates unique, varied Arabic content for service pages,
 * neighborhood pages, and cluster pages using template mixing
 * and section shuffling to avoid duplicate content.
 */
class ContentTemplateService
{
    /**
     * Generate neighborhood page content.
     */
    public function generateNeighborhoodContent(
        string $neighborhoodName,
        string $clusterNameAr,
        array $landmarks = [],
        int $variationSeed = 0
    ): string {
        $city = config('business.city_ar');
        $phone = config('business.phone');
        $whatsapp = config('business.whatsapp_url');
        $services = config('business.services');

        $sections = $this->getNeighborhoodSections(
            $neighborhoodName,
            $clusterNameAr,
            $city,
            $phone,
            $landmarks,
            $services
        );

        // Shuffle middle sections based on seed for variation
        $intro = array_shift($sections);
        $outro = array_pop($sections);

        srand($variationSeed);
        shuffle($sections);
        srand();

        array_unshift($sections, $intro);
        $sections[] = $outro;

        return implode("\n\n", $sections);
    }

    /**
     * Generate cluster page content.
     */
    public function generateClusterContent(
        string $clusterNameAr,
        array $neighborhoods
    ): string {
        $city = config('business.city_ar');
        $phone = config('business.phone');
        $whatsapp = config('business.whatsapp_url');
        $services = config('business.services');

        $neighborhoodLinks = '';
        foreach ($neighborhoods as $n) {
            $neighborhoodLinks .= '<li><a href="' . url('/districts/' . request()->route('cluster') . '/' . ($n['slug'] ?? '')) . '">' . ($n['name_ar'] ?? '') . '</a></li>';
        }

        $serviceLinks = '';
        foreach ($services as $s) {
            $serviceLinks .= '<li><a href="' . url('/services/' . $s['slug']) . '">' . $s['title_ar'] . '</a></li>';
        }

        $content = <<<HTML
<div class="district-content">
    <h1>ุดุฑุงุก ุงูุฃุซุงุซ ุงููุณุชุนูู ูู {$clusterNameAr} - {$city}</h1>

    <p>
        ููุฏู ูู {$clusterNameAr} ุฎุฏูุฉ ุดุงููุฉ ูุดุฑุงุก ุงูุฃุซุงุซ ุงููุณุชุนูู ูุงูุนูุด ูุงูููููุงุช ูุงููุทุงุจุฎ ูุงูุณูุฑุงุจ ุจุฃุนูู ุงูุฃุณุนุงุฑ ูู {$city}.
        ูุญู ุดุฑูุฉ ูุชุฎุตุตุฉ ูู ุดุฑุงุก ุงุซุงุซ ูุณุชุนูู ุจุฌุฏุฉ ููุบุทู ุฌููุน ุฃุญูุงุก {$clusterNameAr} ุจุฎุฏูุฉ ุณุฑูุนุฉ ูุงุญุชุฑุงููุฉ.
        ุณูุงุก ููุช ุชุฑุบุจ ูู ุจูุน ุฃุซุงุซ ููุฒูู ุฃู ููููุงุชู ุฃู ุฃู ูุทุน ูุณุชุนููุฉุ ููุญู ูููุฑ ูู ุฃูุถู ุงูุฃุณุนุงุฑ ูุน ุฎุฏูุฉ ุงููู ูุงูููู ุงููุฌุงููุฉ.
        ุงุชุตู ุจูุง ุงูุขู ุนูู ุงูุฑูู {$phone} ูุณูุตู ูู ููุฑุงู ูู ุฃู ุญู ูู ุฃุญูุงุก {$clusterNameAr} ุจุฌุฏุฉ.
    </p>

    <h2>ุฎุฏูุงุชูุง ูู {$clusterNameAr}</h2>
    <p>
        ููุฏู ูุฌููุนุฉ ูุชูุงููุฉ ูู ุงูุฎุฏูุงุช ูุณูุงู {$clusterNameAr} ูู ุฌุฏุฉ. ุฎุฏูุงุชูุง ุชุดูู ุดุฑุงุก ุฌููุน ุฃููุงุน ุงูุฃุซุงุซ ุงููุณุชุนูู
        ูู ุบุฑู ููู ููุฌุงูุณ ูุตุงูููุงุช ูุทุงููุงุช ุทุนุงู ูุฃุฌูุฒุฉ ููุฑุจุงุฆูุฉ. ููุง ูุชุฎุตุต ูู ุดุฑุงุก ุงูููููุงุช ุงููุณุชุนููุฉ ุจุฌููุน ุฃููุงุนูุง
        ุณูุงุก ุณุจููุช ุฃู ุดุจุงู ุฃู ูุฑูุฒู. ุจุงูุฅุถุงูุฉ ุฅูู ุดุฑุงุก ุงููุทุงุจุฎ ุงููุณุชุนููุฉ ูุงูุณูุฑุงุจ ุจุฃููุงุนู ูู ุญุฏูุฏ ููุญุงุณ ูุฃูููููู.
    </p>
    <ul class="service-links">{$serviceLinks}</ul>

    <h2>ุงูุฃุญูุงุก ุงูุชู ูุฎุฏููุง ูู {$clusterNameAr}</h2>
    <p>
        ูุตู ุฅูู ุฌููุน ุฃุญูุงุก {$clusterNameAr} ุจุณุฑุนุฉ ูุงุฆูุฉ. ูุฑูููุง ุงููุชุฎุตุต ุฌุงูุฒ ุนูู ูุฏุงุฑ ุงูุณุงุนุฉ ูุชูุฏูู ุฎุฏูุฉ
        ุงููุนุงููุฉ ูุงูุชูููู ูุงูุดุฑุงุก ูู ุฃู ุญู ูู ุงูุฃุญูุงุก ุงูุชุงููุฉ:
    </p>
    <ul class="neighborhood-links">{$neighborhoodLinks}</ul>

    <h2>ููุงุฐุง ูุญู ุงูุฎูุงุฑ ุงูุฃูุถู ูู {$clusterNameAr}ุ</h2>
    <div class="why-us-grid">
        <div class="why-item">
            <h3>ุฃุนูู ุงูุฃุณุนุงุฑ</h3>
            <p>ููุฏู ุฃุนูู ุฃุณุนุงุฑ ุดุฑุงุก ุงูุฃุซุงุซ ุงููุณุชุนูู ูู {$clusterNameAr} ููุงุฑูุฉ ุจุฃู ุดุฑูุฉ ุฃุฎุฑู ูู ุฌุฏุฉ.</p>
        </div>
        <div class="why-item">
            <h3>ุฎุฏูุฉ ุณุฑูุนุฉ</h3>
            <p>ูุตู ูู ูู ุฃูู ูู 30 ุฏูููุฉ ูู ุฌููุน ุฃุญูุงุก {$clusterNameAr} ุจุฌุฏุฉ.</p>
        </div>
        <div class="why-item">
            <h3>ูู ูููู ูุฌุงูู</h3>
            <p>ูููุฑ ุฎุฏูุฉ ุงููู ูุงูููู ุงููุฌุงูู ูุฌููุน ุงููุทุน ุงููุดุชุฑุงุฉ ูู {$clusterNameAr}.</p>
        </div>
        <div class="why-item">
            <h3>ุฏูุน ููุฏู ููุฑู</h3>
            <p>ูููู ุจุงูุฏูุน ููุฏูุงู ููุฑ ุงูุงุชูุงู ุนูู ุงูุณุนุฑ ุฏูู ุฃู ุชุฃุฎูุฑ.</p>
        </div>
    </div>

    <h2>ููู ุชุชู ุนูููุฉ ุงูุดุฑุงุก ูู {$clusterNameAr}ุ</h2>
    <ol class="process-steps">
        <li><strong>ุงูุงุชุตุงู ุจูุง:</strong> ุชูุงุตู ูุนูุง ุนุจุฑ ุงููุงุชู ุฃู ุงููุงุชุณุงุจ ูุฃุฎุจุฑูุง ุจุงููุทุน ุงููุฑุงุฏ ุจูุนูุง.</li>
        <li><strong>ุงูุฒูุงุฑุฉ ูุงููุนุงููุฉ:</strong> ูุตูู ูุฑูููุง ุงููุชุฎุตุต ููุนุงููุฉ ุงูุฃุซุงุซ ูู ููุฒูู ุจู{$clusterNameAr}.</li>
        <li><strong>ุงูุชูููู ูุงูุนุฑุถ:</strong> ููุฏู ูู ุนุฑุถ ุณุนุฑ ุนุงุฏู ูุดูุงู ุจูุงุกู ุนูู ุญุงูุฉ ุงููุทุน ููููุชูุง ุงูุณูููุฉ.</li>
        <li><strong>ุงูุงุชูุงู ูุงูุฏูุน:</strong> ุจุนุฏ ุงูููุงููุฉ ูููู ุจุงูุฏูุน ุงูููุฏู ููุฑุงู.</li>
        <li><strong>ุงููู ูุงูููู:</strong> ูุฑูููุง ูุชููู ุนูููุฉ ุงููู ูุงูููู ุจุงููุงูู ุฏูู ุฃู ุชูููุฉ ุฅุถุงููุฉ.</li>
    </ol>

    <h2>ูุตุงุฆุญ ุนูุฏ ุจูุน ุงูุฃุซุงุซ ุงููุณุชุนูู ูู {$clusterNameAr}</h2>
    <p>
        ูุจู ุฃู ุชูุฑุฑ ุจูุน ุฃุซุงุซู ุงููุณุชุนูู ูู {$clusterNameAr}ุ ุฅููู ุจุนุถ ุงููุตุงุฆุญ ุงููููุฉ ุงูุชู ุชุณุงุนุฏู ูู ุงูุญุตูู ุนูู ุฃูุถู ุณุนุฑ:
    </p>
    <ul>
        <li>ุชุฃูุฏ ูู ูุธุงูุฉ ุงููุทุน ุงููุฑุงุฏ ุจูุนูุง ุญูุซ ุฃู ุงููุธูุฑ ุงูุฌูุฏ ูุฑูุน ูู ูููุชูุง.</li>
        <li>ุงุญุชูุธ ุจุฃู ููุงุชูุฑ ุฃู ุถูุงูุงุช ููุฃุฌูุฒุฉ ุงูููุฑุจุงุฆูุฉ ูุงูููููุงุช.</li>
        <li>ุฃุฎุจุฑูุง ุจุฌููุน ุงูุชูุงุตูู ุนุจุฑ ุงููุงุชู ูุชุณููู ุนูููุฉ ุงูุชูููู.</li>
        <li>ูุง ุชุชุฎูุต ูู ุฃู ูุทุนุฉ ูุจู ุงูุชูุงุตู ูุนูุง ููุฏ ุชููู ุฐุงุช ูููุฉ.</li>
    </ul>

    <div class="cta-section">
        <h2>ุชูุงุตู ูุนูุง ุงูุขู ูู {$clusterNameAr}</h2>
        <p>ูุง ุชุชุฑุฏุฏ ูู ุงูุงุชุตุงู ุจูุง ููุญุตูู ุนูู ุฃูุถู ุนุฑุถ ุณุนุฑ ูุฃุซุงุซู ุงููุณุชุนูู ูู {$clusterNameAr} ุจุฌุฏุฉ.</p>
        <div class="cta-buttons">
            <a href="tel:{$phone}" class="btn btn-call" data-track="call-cluster">๐ ุงุชุตู ุงูุขู: {$phone}</a>
            <a href="{$whatsapp}" class="btn btn-whatsapp" target="_blank" rel="noopener" data-track="whatsapp-cluster">๐ฌ ูุงุชุณุงุจ</a>
        </div>
    </div>
</div>
HTML;

        return $content;
    }

    /**
     * Get varied sections for a neighborhood page.
     */
    protected function getNeighborhoodSections(
        string $neighborhood,
        string $cluster,
        string $city,
        string $phone,
        array $landmarks,
        array $services
    ): array {
        $whatsapp = config('business.whatsapp_url');

        $landmarkText = '';
        if (!empty($landmarks)) {
            $landmarkText = 'ุจุงููุฑุจ ูู ' . implode(' ู', $landmarks);
        }

        $serviceLinks = '';
        foreach ($services as $s) {
            $serviceLinks .= '<li><a href="' . url('/services/' . $s['slug']) . '">' . $s['title_ar'] . '</a></li>';
        }

        // Intro variations
        $intros = [
            "<h1>ุดุฑุงุก ุงุซุงุซ ูุณุชุนูู ูู {$neighborhood} ุจุฌุฏุฉ</h1>
            <p>
                ูู ุชุจุญุซ ุนู ุดุฑูุฉ ุดุฑุงุก ุงุซุงุซ ูุณุชุนูู ูู {$neighborhood} ุจุฌุฏุฉุ ูุญู ูููุฑ ูู ุฃูุถู ุฎุฏูุฉ ุดุฑุงุก ููุฃุซุงุซ ุงููุณุชุนูู ูุงูุนูุด ูุงูููููุงุช ูุงููุทุงุจุฎ ูู {$neighborhood} {$landmarkText}.
                ูุดุชุฑู ุฌููุน ุฃููุงุน ุงูุฃุซุงุซ ุงููุณุชุนูู ุจุฃุนูู ุงูุฃุณุนุงุฑ ูู {$neighborhood} ูููุฏู ุฎุฏูุฉ ูู ูููู ูุฌุงููุฉ ูุน ุฏูุน ููุฏู ููุฑู.
                ูุฑูููุง ุงููุชุฎุตุต ูุตู ุฅููู ูู {$neighborhood} ุฎูุงู ุฏูุงุฆู ูุนุฏูุฏุฉ ููุนุงููุฉ ูุชูููู ุฃุซุงุซู ุงููุณุชุนูู ูุชูุฏูู ุฃูุถู ุนุฑุถ ุณุนุฑ.
                ุงุชุตู ุจูุง ุงูุขู ุนูู ุงูุฑูู {$phone} ุฃู ุชูุงุตู ูุนูุง ุนุจุฑ ุงููุงุชุณุงุจ ููุญุตูู ุนูู ุชูููู ูุฌุงูู ูุนุฑุถ ุณุนุฑ ููุฑู ูุฃุซุงุซู ุงููุณุชุนูู ูู {$neighborhood} ุจุฌุฏุฉ.
            </p>",

            "<h1>ุดุฑุงุก ุงูุฃุซุงุซ ุงููุณุชุนูู ูุงูุนูุด ูู {$neighborhood} - {$city}</h1>
            <p>
                ูุญู ุงูุดุฑูุฉ ุงูุฑุงุฆุฏุฉ ูู ูุฌุงู ุดุฑุงุก ุงูุฃุซุงุซ ุงููุณุชุนูู ูู {$neighborhood} ุจุฌุฏุฉ. ูุชููุฒ ุจุชูุฏูู ุฃุนูู ุงูุฃุณุนุงุฑ ูุฌููุน ุฃููุงุน ุงูุฃุซุงุซ ูุงูุนูุด ุงููุณุชุนูู.
                ุฅู ููุช ูู {$neighborhood} {$landmarkText} ูุชุฑุบุจ ูู ุจูุน ุฃุซุงุซู ุงููุณุชุนูู ุฃู ููููุงุชู ุฃู ูุทุจุฎูุ ููุญู ุฎูุงุฑู ุงูุฃูุซู.
                ูููุฑ ุฎุฏูุฉ ุดุงููุฉ ุชุจุฏุฃ ูู ุงููุนุงููุฉ ุงููุฌุงููุฉ ูุญุชู ุงููู ูุงูููู ูุงูุฏูุน ุงูููุฏู ุงูููุฑู.
                ุณููุงุช ูู ุงูุฎุจุฑุฉ ูู ุฎุฏูุฉ ุณูุงู {$neighborhood} ูุงูุฃุญูุงุก ุงููุฌุงูุฑุฉ ูู {$cluster} ุฌุนูุชูุง ุงูุฎูุงุฑ ุงูููุถู ููุนููุงุก.
            </p>",
        ];

        $introIndex = crc32($neighborhood) % count($intros);

        $sections = [];
        $sections[] = $intros[$introIndex];

        // Services section
        $sections[] = "<h2>ุฎุฏูุงุชูุง ูู {$neighborhood}</h2>
        <p>ููุฏู ูู {$neighborhood} ูุฌููุนุฉ ุดุงููุฉ ูู ุฎุฏูุงุช ุดุฑุงุก ุงูุฃุซุงุซ ุงููุณุชุนูู ุชูุจู ุฌููุน ุงุญุชูุงุฌุงุชูู:</p>
        <ul class=\"service-links\">{$serviceLinks}</ul>
        <p>ูู ุฎุฏูุฉ ูู ุฎุฏูุงุชูุง ูู {$neighborhood} ุชุชุถูู ุงููุนุงููุฉ ุงููุฌุงููุฉ ูุงูุชูููู ุงูุนุงุฏู ูุงููู ูุงูููู ูุงูุฏูุน ุงูููุฑู.</p>";

        // Items we buy
        $sections[] = "<h2>ุงูุนูุงุตุฑ ุงูุชู ูุดุชุฑููุง ูู {$neighborhood}</h2>
        <p>ูุดุชุฑู ูู {$neighborhood} ุจุฌุฏุฉ ูุฌููุนุฉ ูุงุณุนุฉ ูู ุงูุฃุซุงุซ ูุงููุนุฏุงุช ุงููุณุชุนููุฉ ุชุดูู:</p>
        <ul>
            <li><strong>ุบุฑู ุงูููู:</strong> ุฃุณูุฑูุฉุ ุฏูุงููุจ ููุงุจุณุ ุชุณุฑูุญุงุชุ ูููุฏููู ุจุฌููุน ุงููุงุฑูุงุช ูุงูุฃุญุฌุงู.</li>
            <li><strong>ุงููุฌุงูุณ ูุงูุตุงูููุงุช:</strong> ููุจุ ุฌูุณุงุช ุนุฑุจูุฉุ ุทุงููุงุชุ ุณุชุงุฆุฑ ูุงุฎุฑุฉ.</li>
            <li><strong>ุบุฑู ุงูุทุนุงู:</strong> ุทุงููุงุช ุทุนุงูุ ูุฑุงุณูุ ุจููููุงุชุ ุณูุฑุงุช ูุงููุฉ.</li>
            <li><strong>ุงูููููุงุช:</strong> ุณุจููุชุ ุดุจุงูุ ูุฑูุฒูุ ุตุญุฑุงูู ุจุฌููุน ุงูุฃุญุฌุงู ูุงููุงุฑูุงุช.</li>
            <li><strong>ุงููุทุงุจุฎ:</strong> ูุทุงุจุฎ ุฎุดุจุ ุฃููููููุ ุฌุฑุงููุช ูุน ุฌููุน ุงูุฃุฌูุฒุฉ.</li>
            <li><strong>ุงูุณูุฑุงุจ:</strong> ุญุฏูุฏุ ูุญุงุณุ ุฃููููููุ ุจูุงุณุชููุ ูุงุจูุงุช ููุฑุจุงุฆูุฉ.</li>
            <li><strong>ุงูุฃุฌูุฒุฉ ุงูููุฑุจุงุฆูุฉ:</strong> ุซูุงุฌุงุชุ ุบุณุงูุงุชุ ุฃูุฑุงูุ ุดุงุดุงุช ุชููุฒููู.</li>
        </ul>";

        // Pricing section
        $sections[] = "<h2>ููู ูุญุฏุฏ ุณุนุฑ ุงูุฃุซุงุซ ุงููุณุชุนูู ูู {$neighborhood}ุ</h2>
        <p>
            ูุชุจุน ูู ุดุฑูุชูุง ูููุฌูุฉ ุงุญุชุฑุงููุฉ ูุชุญุฏูุฏ ุณุนุฑ ุงูุฃุซุงุซ ุงููุณุชุนูู ูู {$neighborhood} ุจูุงุกู ุนูู ุนุฏุฉ ูุนุงููุฑ ุฏูููุฉ:
        </p>
        <ul>
            <li><strong>ุญุงูุฉ ุงููุทุนุฉ:</strong> ููููู ุงูุญุงูุฉ ุงูุนุงูุฉ ููุฃุซุงุซ ูู ุญูุซ ุงููุชุงูุฉ ูุงููุธูุฑ ููุฏู ุตูุงุญูุชู ููุงุณุชุฎุฏุงู.</li>
            <li><strong>ุงููุงุฑูุฉ ูุงูุฌูุฏุฉ:</strong> ุงูุฃุซุงุซ ูู ุงููุงุฑูุงุช ุงููุนุฑููุฉ ูุงูุฎุงูุงุช ุงูุนุงููุฉ ูุญุตู ุนูู ุชูููู ุฃุนูู.</li>
            <li><strong>ุงูุนูุฑ ุงูุงูุชุฑุงุถู:</strong> ูุฃุฎุฐ ุจุนูู ุงูุงุนุชุจุงุฑ ุนูุฑ ุงููุทุนุฉ ูุณููุงุช ุงุณุชุฎุฏุงููุง.</li>
            <li><strong>ุงูุทูุจ ูู ุงูุณูู:</strong> ุจุนุถ ุงููุทุน ุนูููุง ุทูุจ ุฃูุจุฑ ููุง ูุฑูุน ูู ูููุชูุง.</li>
            <li><strong>ุงููููุฉ:</strong> ุดุฑุงุก ูููุงุช ุฃูุจุฑ ูุฏ ูููุญู ุณุนุฑุงู ุฃูุถู.</li>
        </ul>";

        // Transport section
        $sections[] = "<h2>ุฎุฏูุฉ ุงูููู ูุงููู ูู {$neighborhood}</h2>
        <p>
            ูููุฑ ุฎุฏูุฉ ูู ูููู ุงุญุชุฑุงููุฉ ูุฌููุน ุงููุทุน ุงููุดุชุฑุงุฉ ูู {$neighborhood} ุจุฌุฏุฉ.
            ูุฑูููุง ุงููุฏุฑุจ ูููู ุจูู ุงูุฃุซุงุซ ุจุนูุงูุฉ ูุงุฆูุฉ ุฏูู ุฃู ุฃุถุฑุงุฑุ ุณูุงุก ูุงูุช ุบุฑู ููู ุฃู ูุทุงุจุฎ ุฃู ููููุงุช.
            ููุชูู ุณูุงุฑุงุช ููู ูุฌูุฒุฉ ุฎุตูุตุงู ูููู ุงูุฃุซุงุซ ุจุฃูุงู ุชุงู.
            ูู ูุฐุง ูุฌุงูุงู - ูุง ูุชูุงุถู ุฃู ุฑุณูู ุฅุถุงููุฉ ุนูู ุฎุฏูุฉ ุงููู ูุงูููู ูู {$neighborhood} ูุฌููุน ุฃุญูุงุก {$cluster}.
        </p>";

        // Near me section
        $sections[] = "<h2>ุดุฑุงุก ุงุซุงุซ ูุณุชุนูู ุจุงููุฑุจ ููู ูู {$neighborhood}</h2>
        <p>
            ุฅุฐุง ููุช ุชุจุญุซ ุนู ูุญู ุดุฑุงุก ุงุซุงุซ ูุณุชุนูู ุจุงููุฑุจ ููู ูู {$neighborhood} ุจุฌุฏุฉุ ูุฃูุช ูู ุงูููุงู ุงูุตุญูุญ.
            ูุญู ูุณูุง ูุฌุฑุฏ ูุญูุ ุจู ุดุฑูุฉ ูุชูุงููุฉ ูุชุฎุตุตุฉ ูู ุดุฑุงุก ุงูุฃุซุงุซ ุงููุณุชุนูู ููุตู ุฅููู ุฃูููุง ููุช ูู {$neighborhood} {$landmarkText}.
            ูุง ุญุงุฌุฉ ููุจุญุซ ุนู \"ุดุฑุงุก ุงุซุงุซ ูุณุชุนูู ูุฑูุจ ููู\" - ููุท ุงุชุตู ุจูุง ูุณูููู ุนูุฏู ูู ุฃุณุฑุน ููุช.
        </p>";

        // NAP block
        $sections[] = "<div class=\"nap-block\">
            <h3>ูุนูููุงุช ุงูุชูุงุตู - {$neighborhood}</h3>
            <p><strong>ุงููุงุชู:</strong> <a href=\"tel:{$phone}\" data-track=\"call-neighborhood\">{$phone}</a></p>
            <p><strong>ูุงุชุณุงุจ:</strong> <a href=\"{$whatsapp}\" target=\"_blank\" rel=\"noopener\" data-track=\"whatsapp-neighborhood\">ุชูุงุตู ุนุจุฑ ุงููุงุชุณุงุจ</a></p>
            <p><strong>ุงูููุทูุฉ:</strong> {$neighborhood}ุ {$cluster}ุ {$city}</p>
            <p><strong>ุณุงุนุงุช ุงูุนูู:</strong> ุนูู ูุฏุงุฑ ุงูุณุงุนุฉ 24/7</p>
        </div>";

        // CTA outro
        $sections[] = "<div class=\"cta-section\">
            <h2>ุงุจุฏุฃ ุงูุขู - ุจูุน ุฃุซุงุซู ุงููุณุชุนูู ูู {$neighborhood}</h2>
            <p>ูุง ุชูุชุธุฑ! ุชูุงุตู ูุนูุง ุงูุขู ูุงุญุตู ุนูู ุฃูุถู ุณุนุฑ ูุฃุซุงุซู ุงููุณุชุนูู ูู {$neighborhood} ุจุฌุฏุฉ. ูุตู ุฅููู ููุฑุงู ูููุฏู ูู ุนุฑุถ ุณุนุฑ ุนุงุฏู ูุน ุฏูุน ููุฏู ููุฑู.</p>
            <div class=\"cta-buttons\">
                <a href=\"tel:{$phone}\" class=\"btn btn-call\" data-track=\"call-neighborhood-cta\">๐ ุงุชุตู ุงูุขู: {$phone}</a>
                <a href=\"{$whatsapp}\" class=\"btn btn-whatsapp\" target=\"_blank\" rel=\"noopener\" data-track=\"whatsapp-neighborhood-cta\">๐ฌ ูุงุชุณุงุจ ููุฑู</a>
            </div>
        </div>";

        return $sections;
    }

    /**
     * Generate FAQ items for a neighborhood.
     */
    public function generateNeighborhoodFaqs(string $neighborhood, int $count = 6): array
    {
        $city = config('business.city_ar');
        $phone = config('business.phone');

        $allFaqs = [
            [
                'question' => "ูู ุณุนุฑ ุดุฑุงุก ุงูุฃุซุงุซ ุงููุณุชุนูู ูู {$neighborhood} ุจุฌุฏุฉุ",
                'answer' => "ูุนุชูุฏ ุณุนุฑ ุดุฑุงุก ุงูุฃุซุงุซ ุงููุณุชุนูู ูู {$neighborhood} ุนูู ุนุฏุฉ ุนูุงูู ูููุง ุญุงูุฉ ุงูุฃุซุงุซ ูููุนู ููุงุฑูุชู ูุนูุฑู. ููุฏู ุฃุนูู ุงูุฃุณุนุงุฑ ูู ุงูุณูู ูููููู ุงูุงุชุตุงู ุจูุง ุนูู {$phone} ููุญุตูู ุนูู ุชูููู ูุฌุงูู.",
            ],
            [
                'question' => "ูู ุชุตููู ุฅูู {$neighborhood} ูุดุฑุงุก ุงูุฃุซุงุซ ุงููุณุชุนููุ",
                'answer' => "ูุนูุ ูุตู ุฅูู ุฌููุน ุฃูุญุงุก {$neighborhood} ูู {$city}. ูุฑูููุง ูุชูุงุฌุฏ ุนูู ูุฏุงุฑ ุงูุณุงุนุฉ ููุตูู ุฎูุงู ุฏูุงุฆู ูู ุงุชุตุงูู.",
            ],
            [
                'question' => "ูู ุฎุฏูุฉ ุงููู ูุงูููู ูุฌุงููุฉ ูู {$neighborhood}ุ",
                'answer' => "ูุนูุ ูููุฑ ุฎุฏูุฉ ูู ูููู ูุฌุงููุฉ ุชูุงูุงู ูุฌููุน ุงููุทุน ุงููุดุชุฑุงุฉ ูู {$neighborhood} ูุฌููุน ุฃุญูุงุก {$city}. ูุง ูุชูุงุถู ุฃู ุฑุณูู ุฅุถุงููุฉ.",
            ],
            [
                'question' => "ูุง ุฃููุงุน ุงูุฃุซุงุซ ุงูุชู ุชุดุชุฑูููุง ูู {$neighborhood}ุ",
                'answer' => "ูุดุชุฑู ุฌููุน ุฃููุงุน ุงูุฃุซุงุซ ุงููุณุชุนูู ูู {$neighborhood} ุจูุง ูู ุฐูู ุบุฑู ุงูููู ูุงููุฌุงูุณ ูุงูุตุงูููุงุช ูุงููุทุงุจุฎ ูุงูููููุงุช ูุงูุฃุฌูุฒุฉ ุงูููุฑุจุงุฆูุฉ ูุงูุณูุฑุงุจ.",
            ],
            [
                'question' => "ูู ุชุดุชุฑูู ุงูููููุงุช ุงููุณุชุนููุฉ ูู {$neighborhood}ุ",
                'answer' => "ุจุงูุชุฃููุฏุ ูุดุชุฑู ุฌููุน ุฃููุงุน ุงูููููุงุช ุงููุณุชุนููุฉ ูู {$neighborhood} - ุณุจููุช ูุดุจุงู ููุฑูุฒู ุจุฃุนูู ุงูุฃุณุนุงุฑ ูุน ุฎุฏูุฉ ุงููู ุงููุฌุงูู.",
            ],
            [
                'question' => "ููู ูุชู ุงูุฏูุน ุนูุฏ ุดุฑุงุก ุงูุฃุซุงุซ ูู {$neighborhood}ุ",
                'answer' => "ูููู ุจุงูุฏูุน ููุฏูุงู ููุฑ ุงูุงุชูุงู ุนูู ุงูุณุนุฑ ูุจุงุดุฑุฉ ูู {$neighborhood}. ูุง ููุฌุฏ ุชุฃุฎูุฑ ุฃู ุงูุชุธุงุฑ.",
            ],
            [
                'question' => "ูู ุชุดุชุฑูู ุงูุณูุฑุงุจ ูุงูุฎุฑุฏุฉ ูู {$neighborhood}ุ",
                'answer' => "ูุนูุ ูุดุชุฑู ุฌููุน ุฃููุงุน ุงูุณูุฑุงุจ ูู {$neighborhood} ุจูุง ูู ุฐูู ุงูุญุฏูุฏ ูุงููุญุงุณ ูุงูุฃูููููู ูุงูุจูุงุณุชูู ุจุฃุณุนุงุฑ ููุชุงุฒุฉ.",
            ],
            [
                'question' => "ูู ูุณุชุบุฑู ุงููุตูู ุฅูู {$neighborhood}ุ",
                'answer' => "ูุตู ุฅูู {$neighborhood} ุนุงุฏุฉู ุฎูุงู 15-30 ุฏูููุฉ ูู ููุช ุงุชุตุงูู. ูุญู ูุชูุงุฌุฏูู ุนูู ูุฏุงุฑ ุงูุณุงุนุฉ ุทูุงู ุฃูุงู ุงูุฃุณุจูุน.",
            ],
        ];

        // Select varied FAQs based on neighborhood name hash
        $seed = crc32($neighborhood);
        srand($seed);
        shuffle($allFaqs);
        srand();

        return array_slice($allFaqs, 0, $count);
    }

    /**
     * Generate service page content.
     */
    public function generateServiceContent(array $service): string
    {
        $city = config('business.city_ar');
        $phone = config('business.phone');
        $whatsapp = config('business.whatsapp_url');
        $title = $service['title_ar'];

        $districtLinks = '';
        $clusters = config('jeddah_districts.clusters');
        $count = 0;
        foreach ($clusters as $cluster) {
            foreach ($cluster['neighborhoods'] as $n) {
                if ($count >= 12) break 2;
                $districtLinks .= '<li><a href="' . url('/districts/' . $cluster['slug'] . '/' . $n['slug']) . '">' . $title . ' ูู ' . $n['name_ar'] . '</a></li>';
                $count++;
            }
        }

        $otherServices = '';
        foreach (config('business.services') as $s) {
            if ($s['slug'] !== $service['slug']) {
                $otherServices .= '<li><a href="' . url('/services/' . $s['slug']) . '">' . $s['title_ar'] . '</a></li>';
            }
        }

        $districtsUrl = url('/districts');

        $content = <<<HTML
<div class="service-content">
    <h1>{$title}</h1>

    <p>
        ูู ุชุจุญุซ ุนู ุฃูุถู ุดุฑูุฉ {$title}ุ ูุญู ุงูุฎูุงุฑ ุงูุฃูุซู ููู ูู ูุฑุบุจ ูู ุจูุน ุฃุซุงุซู ุงููุณุชุนูู ูู {$city} ุจุฃุนูู ุงูุฃุณุนุงุฑ.
        ููุฏู ุฎุฏูุฉ {$title} ุงูุดุงููุฉ ุงูุชู ุชุชุถูู ุงููุนุงููุฉ ุงููุฌุงููุฉ ูุงูุชูููู ุงูุนุงุฏู ูุงููู ูุงูููู ุงููุฌุงูู ูุงูุฏูุน ุงูููุฏู ุงูููุฑู.
        ุณููุงุช ุทูููุฉ ูู ุงูุฎุจุฑุฉ ุฌุนูุชูุง ุงูุดุฑูุฉ ุงูุฑุงุฆุฏุฉ ูู ูุฌุงู {$title} ุญูุซ ูุฎุฏู ุฌููุน ุฃุญูุงุก ูููุงุทู {$city}.
        ุงุชุตู ุจูุง ุงูุขู ุนูู {$phone} ุฃู ุชูุงุตู ูุนูุง ุนุจุฑ ุงููุงุชุณุงุจ ููุญุตูู ุนูู ุฃูุถู ุนุฑุถ ุณุนุฑ ููุฑู.
    </p>

    <h2>ููุงุฐุง ูุญู ุงูุฃูุถู ูู {$title}ุ</h2>
    <p>
        ูุชููุฒ ูู {$city} ุจูุฌููุนุฉ ูู ุงููุฒุงูุง ุงูุชู ุชุฌุนููุง ุงูุฎูุงุฑ ุงูุฃูู ููุนููุงุก ุงูุจุงุญุซูู ุนู ุฎุฏูุฉ {$title}:
    </p>
    <ul>
        <li><strong>ุฃุนูู ุงูุฃุณุนุงุฑ:</strong> ููุฏู ุฃุณุนุงุฑ ุชูุงูุณูุฉ ุชููู ุฃู ุนุฑุถ ุขุฎุฑ ูู {$city}.</li>
        <li><strong>ุณุฑุนุฉ ุงููุตูู:</strong> ูุตู ูู ุฎูุงู 30 ุฏูููุฉ ูู ุฃู ูููุน ุจุฌุฏุฉ.</li>
        <li><strong>ูู ูููู ูุฌุงูู:</strong> ูุฑูููุง ุงููุญุชุฑู ูุชููู ุนูููุฉ ุงููู ูุงูููู ุจุงููุงูู.</li>
        <li><strong>ุฏูุน ููุฑู:</strong> ูููู ุจุงูุฏูุน ููุฏูุงู ููุฑ ุงูุงุชูุงู ุฏูู ุฃู ุชุฃุฎูุฑ.</li>
        <li><strong>ุฎุฏูุฉ 24/7:</strong> ูุชุงุญูู ุนูู ูุฏุงุฑ ุงูุณุงุนุฉ ุทูุงู ุฃูุงู ุงูุฃุณุจูุน.</li>
        <li><strong>ุชุนุงูู ุงุญุชุฑุงูู:</strong> ูุฑูู ูุฏุฑุจ ููุญุชุฑู ูุชุนุงูู ูุน ุฃุซุงุซู ุจุนูุงูุฉ ูุงุฆูุฉ.</li>
    </ul>

    <h2>ุงูุนูุงุตุฑ ุงูุชู ูุดุชุฑููุง</h2>
    <p>
        ูู ุฎูุงู ุฎุฏูุฉ {$title}ุ ูุดุชุฑู ูุฌููุนุฉ ูุงุณุนุฉ ููุชููุนุฉ ูู ุงููุทุน ูุงูุนูุงุตุฑ ุงูุชู ุชุดูู:
    </p>
    <ul>
        <li>ุบุฑู ุงูููู ุงููุงููุฉ ุจุฌููุน ููููุงุชูุง (ุฃุณูุฑูุฉุ ุฏูุงููุจุ ุชุณุฑูุญุงุชุ ูููุฏููู).</li>
        <li>ุงููุฌุงูุณ ุงูุนุฑุจูุฉ ูุงูุตุงูููุงุช ุจูุฎุชูู ุฃููุงุนูุง ูุฃุญุฌุงููุง.</li>
        <li>ุบุฑู ุงููุนูุดุฉ ูุงูุฌููุณ ุจูุงูู ุชุฃุซูุซูุง.</li>
        <li>ุทุงููุงุช ุงูุทุนุงู ูุงููุฑุงุณู ูุงูุจููููุงุช.</li>
        <li>ุงูููุงุชุจ ูุงูุฃุซุงุซ ุงูููุชุจู.</li>
        <li>ุงูุฃุฌูุฒุฉ ุงูููุฑุจุงุฆูุฉ ุงูููุฒููุฉ.</li>
        <li>ุงูุซุฑูุงุช ูุงูุฅุถุงุกุงุช.</li>
        <li>ุงูุณุฌุงุฏ ูุงูููููุช.</li>
    </ul>

    <h2>ููู ูุญุฏุฏ ุงูุณุนุฑ</h2>
    <p>
        ูุชุจุน ูุนุงููุฑ ุฏูููุฉ ูุนุงุฏูุฉ ูู ุชุญุฏูุฏ ุณุนุฑ ุดุฑุงุก ุงูุฃุซุงุซ ุงููุณุชุนูู. ูููู ูุฑูููุง ุงููุชุฎุตุต ุจุชูููู ูู ูุทุนุฉ ุจูุงุกู ุนูู:
    </p>
    <ol>
        <li><strong>ุงูุญุงูุฉ ุงูุนุงูุฉ:</strong> ูุฏู ุณูุงูุฉ ุงููุทุนุฉ ูุฎูููุง ูู ุงูุนููุจ ูุงูุชูู.</li>
        <li><strong>ุฌูุฏุฉ ุงูุฎุงูุงุช:</strong> ููุน ุงูุฎุดุจ ุฃู ุงููุงุฏุฉ ุงููุตูุนุฉ ูููุง ุงููุทุนุฉ.</li>
        <li><strong>ุงููุงุฑูุฉ:</strong> ุงููุงุฑูุงุช ุงููุนุฑููุฉ ูุงูุนุงูููุฉ ุชุญุตู ุนูู ุชูููู ุฃุนูู.</li>
        <li><strong>ุงูุนูุฑ:</strong> ุนูุฑ ุงููุทุนุฉ ููุฏุฉ ุงุณุชุฎุฏุงููุง.</li>
        <li><strong>ุงูุทูุจ ุงูุณููู:</strong> ูุฏู ุงูุทูุจ ุนูู ูุฐุง ุงูููุน ูู ุงูุณูู.</li>
        <li><strong>ุงููููุฉ:</strong> ุดุฑุงุก ูุฌููุนุงุช ูุงููุฉ ูุฏ ูููุญู ุณุนุฑุงู ุฃูุถู.</li>
    </ol>

    <h2>ุฎุฏูุฉ ุงูููู ูุงููู</h2>
    <p>
        ูุชููุฒ ุจุชูุฏูู ุฎุฏูุฉ ูู ูููู ุงุญุชุฑุงููุฉ ููุฌุงููุฉ ุจุงููุงูู ูุฌุฒุก ุฃุณุงุณู ูู ุฎุฏูุฉ {$title}:
    </p>
    <ul>
        <li>ูุฑูู ููู ูุชุฎุตุต ูู ูู ุฌููุน ุฃููุงุน ุงูุฃุซุงุซ ูุงููุทุงุจุฎ ูุงูููููุงุช.</li>
        <li>ุฃุฏูุงุช ููุนุฏุงุช ุญุฏูุซุฉ ูุถูุงู ุณูุงูุฉ ุงููุทุน ุฃุซูุงุก ุงููู.</li>
        <li>ุณูุงุฑุงุช ููู ูุฌูุฒุฉ ููุคููุฉ ูููู ุงูุฃุซุงุซ ุจุฃูุงู.</li>
        <li>ุนูุงู ูุฏุฑุจูู ุนูู ุงูุชุนุงูู ูุน ุงููุทุน ุงูุญุณุงุณุฉ ูุงูุซูููุฉ.</li>
        <li>ูุง ุฑุณูู ุฅุถุงููุฉ - ุงูุฎุฏูุฉ ูุฌุงููุฉ ุจุงููุงูู.</li>
    </ul>

    <h2>ุงูุงุณุชูุงู ูุงูุฏูุน</h2>
    <p>
        ุนูููุฉ ุงูุงุณุชูุงู ูุงูุฏูุน ูุฏููุง ุชุชู ุจุณูุงุณุฉ ูุณุฑุนุฉ ุชุงูุฉ. ุจุนุฏ ุงูุงุชูุงู ุนูู ุงูุณุนุฑ:
    </p>
    <ol>
        <li>ูููู ูุฑูููุง ุจูู ุงููุทุน ุงููุชูู ุนูููุง ุจุงุญุชุฑุงููุฉ.</li>
        <li>ูุชู ููู ุงููุทุน ุฅูู ุณูุงุฑุงุชูุง ุงููุฌูุฒุฉ.</li>
        <li>ูุณููู ุงููุจูุบ ุงููุชูู ุนููู ููุฏุงู ุจุงููุงูู.</li>
        <li>ุชุชู ุงูุนูููุฉ ุจุงููุงูู ูู ููุณ ุงูุฒูุงุฑุฉ ุฏูู ุงูุญุงุฌุฉ ูููุงุนูุฏ ุฅุถุงููุฉ.</li>
    </ol>

    <h2>ุฃุญูุงุก {$city} ุงูุชู ูุฎุฏููุง</h2>
    <p>
        ููุฏู ุฎุฏูุฉ {$title} ูู ุฌููุน ุฃุญูุงุก ูููุงุทู {$city}. ุฅููู ุจุนุถ ุงูุฃุญูุงุก ุงูุชู ูุฎุฏููุง ุจุดูู ูุจุงุดุฑ:
    </p>
    <ul class="district-links">{$districtLinks}</ul>
    <p>
        <a href="{$districtsUrl}">ุนุฑุถ ุฌููุน ุฃุญูุงุก {$city} ุงูุชู ูุฎุฏููุง โ</a>
    </p>

    <h2>ุฎุฏูุงุช ุฃุฎุฑู ููุฏููุง</h2>
    <p>ุจุงูุฅุถุงูุฉ ุฅูู {$title}ุ ููุฏู ูุฌููุนุฉ ุฎุฏูุงุช ุฃุฎุฑู ูู {$city}:</p>
    <ul class="related-services">{$otherServices}</ul>

    <div class="cta-section">
        <h2>ุชูุงุตู ูุนูุง ุงูุขู</h2>
        <p>ุงุญุตู ุนูู ุฃูุถู ุณุนุฑ ูุฃุซุงุซู ุงููุณุชุนูู ูู {$city}. ุงุชุตู ุจูุง ุฃู ุฃุฑุณู ูุงุชุณุงุจ ูุณูุตู ูู ููุฑุงู!</p>
        <div class="cta-buttons">
            <a href="tel:{$phone}" class="btn btn-call" data-track="call-service">๐ ุงุชุตู ุงูุขู: {$phone}</a>
            <a href="{$whatsapp}" class="btn btn-whatsapp" target="_blank" rel="noopener" data-track="whatsapp-service">๐ฌ ูุงุชุณุงุจ</a>
        </div>
    </div>
</div>
HTML;

        return $content;
    }
}
